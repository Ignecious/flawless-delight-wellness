<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '80vw' }"
  [breakpoints]="{ '960px': '95vw' }"
  (onHide)="closeDialog()"
>
  <ng-template pTemplate="header">
    <div class="dialog-header">
      <h2>Client Details</h2>
    </div>
  </ng-template>

  <div class="client-detail-content">
    <!-- Section 1: Contact Information -->
    <section class="contact-section">
      <div class="contact-header">
        <h2 class="client-name">{{ client.name }}</h2>
        <p-badge 
          [value]="client.status" 
          [severity]="getClientStatusSeverity(client.status)"
          styleClass="status-badge"
        ></p-badge>
      </div>
      
      <div class="contact-info">
        <div class="info-item">
          <i class="pi pi-envelope"></i>
          <span>{{ client.email }}</span>
        </div>
        <div class="info-item">
          <i class="pi pi-phone"></i>
          <span>{{ client.phone }}</span>
        </div>
        <div class="info-item">
          <i class="pi pi-calendar"></i>
          <span>Customer since {{ formatDate(client.customerSince) }}</span>
        </div>
      </div>
    </section>

    <!-- Section 2: Statistics Cards -->
    <section class="statistics-section">
      <div class="stats-grid">
        <p-card styleClass="stat-card">
          <ng-template pTemplate="content">
            <div class="stat-content">
              <i class="pi pi-dollar stat-icon"></i>
              <div class="stat-info">
                <div class="stat-label">Total Spent</div>
                <div class="stat-value">{{ formatCurrency(client.totalSpent) }}</div>
              </div>
            </div>
          </ng-template>
        </p-card>

        <p-card styleClass="stat-card">
          <ng-template pTemplate="content">
            <div class="stat-content">
              <i class="pi pi-calendar-plus stat-icon"></i>
              <div class="stat-info">
                <div class="stat-label">Total Bookings</div>
                <div class="stat-value">{{ client.totalBookings }}</div>
              </div>
            </div>
          </ng-template>
        </p-card>

        <p-card styleClass="stat-card">
          <ng-template pTemplate="content">
            <div class="stat-content">
              <i class="pi pi-user stat-icon"></i>
              <div class="stat-info">
                <div class="stat-label">Preferred Therapist</div>
                <div class="stat-value">{{ client.preferredTherapist || 'N/A' }}</div>
              </div>
            </div>
          </ng-template>
        </p-card>
      </div>
    </section>

    <!-- Section 3: Booking History -->
    <section class="booking-history-section">
      <h3>Booking History</h3>
      <div class="table-wrapper">
        <p-table 
          [value]="clientBookings" 
          [scrollable]="true"
          scrollHeight="300px"
          styleClass="p-datatable-sm"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Date</th>
              <th>Treatment</th>
              <th>Therapist</th>
              <th>Price</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-booking>
            <tr>
              <td>{{ formatDate(booking.date) }}</td>
              <td>{{ booking.treatment.name }}</td>
              <td>{{ booking.therapist.name }}</td>
              <td>{{ formatCurrency(booking.treatment.price) }}</td>
              <td>
                <p-badge 
                  [value]="booking.status" 
                  [severity]="getStatusSeverity(booking.status)"
                ></p-badge>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center">No bookings found</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </section>

    <!-- Section 4: Favorite Treatments -->
    <section class="favorite-treatments-section">
      <h3>Favorite Treatments</h3>
      <div class="treatments-list" *ngIf="client.favoriteTreatments.length > 0; else noTreatments">
        <div class="treatment-item" *ngFor="let treatment of client.favoriteTreatments">
          <i class="pi pi-star-fill"></i>
          <span>{{ treatment.treatmentName }} ({{ treatment.count }} booking{{ treatment.count > 1 ? 's' : '' }})</span>
        </div>
      </div>
      <ng-template #noTreatments>
        <p class="no-data">No favorite treatments yet</p>
      </ng-template>
    </section>

    <!-- Section 5: Notes -->
    <section class="notes-section">
      <h3>Notes</h3>
      <textarea 
        pInputTextarea 
        [(ngModel)]="editableNotes"
        [rows]="4"
        placeholder="Add notes about this client..."
        class="notes-textarea"
      ></textarea>
      <div class="notes-actions">
        <p-button 
          label="Save Notes" 
          icon="pi pi-save"
          (onClick)="saveNotes()"
        ></p-button>
      </div>
    </section>
  </div>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <p-button 
        label="Edit Contact Info" 
        icon="pi pi-pencil"
        [outlined]="true"
        (onClick)="editContactInfo()"
      ></p-button>
      <p-button 
        label="Book Appointment" 
        icon="pi pi-calendar-plus"
        [outlined]="true"
        (onClick)="bookAppointment()"
      ></p-button>
      <p-button 
        label="Close" 
        icon="pi pi-times"
        (onClick)="closeDialog()"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>

<p-toast></p-toast>
