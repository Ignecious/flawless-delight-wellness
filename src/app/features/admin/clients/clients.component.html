<div class="clients-container">
  <div class="page-header">
    <h1>Clients</h1>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="searchText"
          (ngModelChange)="onSearchChange()"
          placeholder="Search by name, phone, or email"
        />
      </span>
    </div>

    <div class="status-filter">
      <p-dropdown
        [options]="statusFilters"
        [(ngModel)]="selectedStatus"
        (onChange)="onStatusFilterChange()"
        optionLabel="label"
        placeholder="Filter by status"
      ></p-dropdown>
    </div>
  </div>

  <div class="table-container">
    <p-table 
      [value]="filteredClients" 
      [responsive]="true"
      [scrollable]="true"
      scrollHeight="flex"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Name <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th>Phone</th>
          <th>Email</th>
          <th pSortableColumn="totalBookings">
            Total Bookings <p-sortIcon field="totalBookings"></p-sortIcon>
          </th>
          <th pSortableColumn="lastVisit">
            Last Visit <p-sortIcon field="lastVisit"></p-sortIcon>
          </th>
          <th pSortableColumn="totalSpent">
            Total Spent <p-sortIcon field="totalSpent"></p-sortIcon>
          </th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-client>
        <tr>
          <td>
            <div class="client-name">
              {{ client.name }}
              <p-badge 
                [value]="client.status" 
                [severity]="getStatusSeverity(client.status)"
                styleClass="ml-2"
              ></p-badge>
            </div>
          </td>
          <td>{{ client.phone }}</td>
          <td>{{ client.email }}</td>
          <td>{{ client.totalBookings }}</td>
          <td>{{ formatDate(client.lastVisit) }}</td>
          <td>{{ formatCurrency(client.totalSpent) }}</td>
          <td>
            <p-button 
              label="View" 
              icon="pi pi-eye"
              [outlined]="true"
              size="small"
              (onClick)="viewClient(client)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">No clients found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Client Detail Modal -->
<app-client-detail
  *ngIf="selectedClient"
  [client]="selectedClient"
  [visible]="displayClientDetail"
  (onClose)="onClientDetailClose()"
  (onNotesUpdated)="onClientNotesUpdated($event)"
></app-client-detail>

<p-toast></p-toast>
