<div class="calendar-container">
  <p-toast />
  <p-confirmDialog />
  
  <div class="calendar-header">
    <h2>Calendar</h2>
  </div>

  <div class="calendar-controls">
    <div class="date-picker">
      <p-calendar 
        [(ngModel)]="selectedDate" 
        (onSelect)="onDateChange()" 
        [inline]="true"
        dateFormat="yy-mm-dd"
      />
    </div>
    
    <div class="date-navigation">
      <div class="nav-buttons">
        <p-button 
          label="Previous Day" 
          icon="pi pi-chevron-left" 
          (onClick)="previousDay()" 
          [outlined]="true"
        />
        <p-button 
          label="Next Day" 
          icon="pi pi-chevron-right" 
          iconPos="right"
          (onClick)="nextDay()" 
          [outlined]="true"
        />
      </div>
      <h3 class="selected-date">{{ getFormattedDate() }}</h3>
    </div>
  </div>

  <div class="calendar-table">
    <p-table [value]="timeSlots" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>Time</th>
          <th>Treatment</th>
          <th>Customer</th>
          <th>Therapist</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-slot>
        <tr>
          <td>{{ slot.time }}</td>
          <td>
            <span *ngIf="slot.booking">{{ slot.booking.treatment.name }}</span>
            <span *ngIf="!slot.booking" class="available">Available</span>
          </td>
          <td>
            <span *ngIf="slot.booking">{{ slot.booking.customer.name }}</span>
            <span *ngIf="!slot.booking">-</span>
          </td>
          <td>
            <span *ngIf="slot.booking">{{ slot.booking.therapist.name }}</span>
            <span *ngIf="!slot.booking">-</span>
          </td>
          <td>
            <p-badge 
              *ngIf="slot.booking" 
              [value]="slot.booking.status" 
              [severity]="getStatusSeverity(slot.booking.status)"
            />
            <span *ngIf="!slot.booking">-</span>
          </td>
          <td>
            <div class="action-buttons" *ngIf="slot.booking">
              <p-button 
                icon="pi pi-eye" 
                [rounded]="true" 
                [text]="true" 
                (onClick)="viewDetails(slot.booking)"
                pTooltip="View Details"
              />
              <p-button 
                *ngIf="slot.booking.status === 'pending'"
                icon="pi pi-check" 
                [rounded]="true" 
                [text]="true" 
                severity="success"
                (onClick)="confirmBooking(slot.booking)"
                pTooltip="Confirm"
              />
              <p-button 
                icon="pi pi-times" 
                [rounded]="true" 
                [text]="true" 
                severity="danger"
                (onClick)="cancelBooking(slot.booking)"
                pTooltip="Cancel"
              />
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- View Details Dialog -->
  <p-dialog 
    [(visible)]="displayDetailsDialog" 
    [header]="'Booking Details - #' + selectedBooking?.id" 
    [modal]="true" 
    [style]="{ width: '500px' }"
  >
    <div class="booking-details" *ngIf="selectedBooking">
      <div class="detail-row">
        <span class="label">Date:</span>
        <span class="value">{{ selectedBooking.date | date: 'fullDate' }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Time:</span>
        <span class="value">{{ selectedBooking.timeSlot }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Treatment:</span>
        <span class="value">{{ selectedBooking.treatment.name }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Duration:</span>
        <span class="value">{{ selectedBooking.treatment.duration }} minutes</span>
      </div>
      <div class="detail-row">
        <span class="label">Price:</span>
        <span class="value">
          {{ selectedBooking.treatment.price === 0 ? 'FREE' : 'R' + selectedBooking.treatment.price }}
        </span>
      </div>
      <div class="detail-row">
        <span class="label">Customer:</span>
        <span class="value">{{ selectedBooking.customer.name }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Phone:</span>
        <span class="value">{{ selectedBooking.customer.phone }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Email:</span>
        <span class="value">{{ selectedBooking.customer.email }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Therapist:</span>
        <span class="value">{{ selectedBooking.therapist.name }}</span>
      </div>
      <div class="detail-row">
        <span class="label">Status:</span>
        <span class="value">
          <p-badge 
            [value]="selectedBooking.status" 
            [severity]="getStatusSeverity(selectedBooking.status)"
          />
        </span>
      </div>
      <div class="detail-row">
        <span class="label">Created:</span>
        <span class="value">{{ selectedBooking.createdAt | date: 'medium' }}</span>
      </div>
    </div>
  </p-dialog>
</div>
